

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>kinect_processing &mdash; panda_autograsp 1.0.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="plan_grasp" href="plan_grasp.html" />
    <link rel="prev" title="generate_arucoboard" href="generate_arucoboard.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> panda_autograsp
          

          
            
            <img src="../../_static/panda_autograsp.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Panda_autograsp package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../info/info.html">Package information</a></li>
</ul>
<p class="caption"><span class="caption-text">Installation Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html#package-build-from-source-instructions">Package build from source instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html#singularity-container-installation-instructions">Singularity Container installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html#docker-container-installation-instructions">Docker container installation instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/usage.html">Sensor calibration instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/usage.html#package-use-instructions">Package use instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/usage.html#singularity-container-instructions">Singularity container instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/usage.html#troubleshooting-information">Troubleshooting information</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">Python Code API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api.html#panda-autograsp-modules">Panda autograsp modules</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../api.html#panda-autograsp-scripts">Panda autograsp scripts</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="aruco_pose_estimation.html">aruco_pose_estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="chessboard_calibration.html">chessboard_calibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="generate_arucoboard.html">generate_arucoboard</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">kinect_processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#source-code">Source code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plan_grasp.html">plan_grasp</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#panda-autograsp-ros-nodes">Panda_autograsp ROS nodes</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">License</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../license/license.html">License</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Zone</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev/release_dev.html">Release package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/doc_dev.html">Release documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">panda_autograsp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../api.html">Python Code API</a> &raquo;</li>
        
      <li>kinect_processing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/api/_autosummary/kinect_processing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-kinect_processing">
<span id="kinect-processing"></span><h1>kinect_processing<a class="headerlink" href="#module-kinect_processing" title="Permalink to this headline">¶</a></h1>
<p>This script can be used retrieve ir, color, depth and registered images from
the Kinect camera. The images will be saved in the <code class="docutils literal notranslate"><span class="pre">data/frames</span></code> folder.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Usage:</strong></p>
<blockquote class="last">
<div><ul class="simple">
<li><strong>[q]:</strong> Stop the kinect_processing script.</li>
<li><strong>[s]:</strong> Save kinect frames.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Main python packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pylibfreenect2</span> <span class="kn">import</span> <span class="n">Freenect2</span><span class="p">,</span> <span class="n">SyncMultiFrameListener</span>
<span class="kn">from</span> <span class="nn">pylibfreenect2</span> <span class="kn">import</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">Registration</span><span class="p">,</span> <span class="n">Frame</span>

<span class="c1"># Panda_autograsp modules, msgs and srvs</span>
<span class="kn">from</span> <span class="nn">panda_autograsp</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="c1"># Create script logger</span>
<span class="n">script_logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;kinect_processing.py&quot;</span><span class="p">)</span>

<span class="c1">#################################################</span>
<span class="c1"># Kinect process settings #######################</span>
<span class="c1">#################################################</span>

<span class="n">NEED_BIGDEPTH</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># Use Full size depth image</span>
<span class="n">NEED_COLOR_DEPTH_MAP</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># Overlay depth and colour</span>
<span class="n">DATA_SAVE_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;data/frames&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">#################################################</span>
<span class="c1"># Main script ###################################</span>
<span class="c1">#################################################</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># Welcome message</span>
    <span class="k">print</span><span class="p">(</span>
        <span class="s2">&quot;== Kinect processing script ==</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;This script can be used retrieve ir, color, </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;depth and registered images from the Kinect </span><span class="se">\n</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;camera. The images will be saved in the </span><span class="se">\n</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;``data/frames`` folder.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Usage: </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;  [q]: Stop the kinect_processing script. </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;  [s]: Save kinect frames.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># set root logger format</span>
    <span class="n">root_logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span>
        <span class="n">log_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                <span class="s2">&quot;..&quot;</span><span class="p">,</span>
                <span class="s2">&quot;logs/kinect_processing.log&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1">#############################################</span>
    <span class="c1"># Kinect initiation settings ################</span>
    <span class="c1">#############################################</span>

    <span class="c1"># Open depth package pipline</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># Check if GPU can be used</span>
        <span class="kn">from</span> <span class="nn">pylibfreenect2</span> <span class="kn">import</span> <span class="n">OpenCLPacketPipeline</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">OpenCLPacketPipeline</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># Otherwise open CPU</span>
        <span class="kn">from</span> <span class="nn">pylibfreenect2</span> <span class="kn">import</span> <span class="n">CpuPacketPipeline</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">CpuPacketPipeline</span><span class="p">()</span>

    <span class="c1"># Create freenect2 object and check sensor properties</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">Freenect2</span><span class="p">()</span>
    <span class="n">num_devices</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">enumerateDevices</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">num_devices</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">script_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No device connected!&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">serial</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">getDeviceSerialNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">openDevice</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">=</span><span class="n">pipeline</span><span class="p">)</span>
    <span class="n">listener</span> <span class="o">=</span> <span class="n">SyncMultiFrameListener</span><span class="p">(</span><span class="n">FrameType</span><span class="o">.</span><span class="n">Color</span> <span class="o">|</span> <span class="n">FrameType</span><span class="o">.</span><span class="n">Ir</span> <span class="o">|</span> <span class="n">FrameType</span><span class="o">.</span><span class="n">Depth</span><span class="p">)</span>

    <span class="c1"># Register frame listeners</span>
    <span class="n">device</span><span class="o">.</span><span class="n">setColorFrameListener</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>
    <span class="n">device</span><span class="o">.</span><span class="n">setIrAndDepthFrameListener</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>

    <span class="c1"># Start data processing</span>
    <span class="n">device</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Combine IR and Color data</span>
    <span class="n">registration</span> <span class="o">=</span> <span class="n">Registration</span><span class="p">(</span>
        <span class="n">device</span><span class="o">.</span><span class="n">getIrCameraParams</span><span class="p">(),</span> <span class="n">device</span><span class="o">.</span><span class="n">getColorCameraParams</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># Set sensor frames formats</span>
    <span class="n">undistorted</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">424</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">registered</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">424</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">bigdepth</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1082</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="k">if</span> <span class="n">NEED_BIGDEPTH</span> <span class="k">else</span> <span class="bp">None</span>
    <span class="n">color_depth_map</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">424</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">NEED_COLOR_DEPTH_MAP</span> <span class="k">else</span> <span class="bp">None</span>
    <span class="p">)</span>

    <span class="c1">#############################################</span>
    <span class="c1"># Kinect frame process loop #################</span>
    <span class="c1">#############################################</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

        <span class="c1"># Get frames</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="n">waitForNewFrame</span><span class="p">()</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
        <span class="n">ir</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="s2">&quot;ir&quot;</span><span class="p">]</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span>

        <span class="c1"># Process frames</span>
        <span class="n">registration</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">color</span><span class="p">,</span>
            <span class="n">depth</span><span class="p">,</span>
            <span class="n">undistorted</span><span class="p">,</span>
            <span class="n">registered</span><span class="p">,</span>
            <span class="n">bigdepth</span><span class="o">=</span><span class="n">bigdepth</span><span class="p">,</span>
            <span class="n">color_depth_map</span><span class="o">=</span><span class="n">color_depth_map</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Visualize frames</span>
        <span class="c1"># NOTE for visualization:</span>
        <span class="c1"># cv2.imshow without OpenGL backend seems to be quite slow to draw all</span>
        <span class="c1"># things below. Try commenting out some imshow if you don&#39;t have a fast</span>
        <span class="c1"># visualization backend.</span>
        <span class="n">ir_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;ir&quot;</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span> <span class="o">/</span> <span class="mf">65535.0</span><span class="p">)</span>
        <span class="n">depth_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;depth&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span> <span class="o">/</span> <span class="mf">4500.0</span><span class="p">)</span>
        <span class="n">color_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">asarray</span><span class="p">(),</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1920</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1080</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="p">)</span>
        <span class="n">reg_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;registered&quot;</span><span class="p">,</span> <span class="n">registered</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">NEED_BIGDEPTH</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
                <span class="s2">&quot;bigdepth&quot;</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
                    <span class="n">bigdepth</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1920</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1082</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">NEED_COLOR_DEPTH_MAP</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;color_depth_map&quot;</span><span class="p">,</span> <span class="n">color_depth_map</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">424</span><span class="p">,</span> <span class="mi">512</span><span class="p">))</span>
        <span class="n">listener</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

        <span class="c1"># Break if someone presses q or esc</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="mi">27</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)):</span>
            <span class="k">break</span>

        <span class="c1"># Save frames to datafolder if user presses ctrl + s</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>

            <span class="c1"># Save frames</span>
            <span class="n">time_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">-%H%M%S&quot;</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">DATA_SAVE_FOLDER</span> <span class="o">+</span> <span class="s2">&quot;/ir_&quot;</span> <span class="o">+</span> <span class="n">time_str</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">ir_img</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">DATA_SAVE_FOLDER</span> <span class="o">+</span> <span class="s2">&quot;/depth_&quot;</span> <span class="o">+</span> <span class="n">time_str</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">depth_img</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">DATA_SAVE_FOLDER</span> <span class="o">+</span> <span class="s2">&quot;/color_&quot;</span> <span class="o">+</span> <span class="n">time_str</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">color_img</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">DATA_SAVE_FOLDER</span> <span class="o">+</span> <span class="s2">&quot;/reg_&quot;</span> <span class="o">+</span> <span class="n">time_str</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">reg_img</span><span class="p">)</span>
            <span class="n">script_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saving frames to data folder&quot;</span><span class="p">)</span>

    <span class="c1"># Shutdown kinect connection</span>
    <span class="n">device</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="n">device</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plan_grasp.html" class="btn btn-neutral float-right" title="plan_grasp" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="generate_arucoboard.html" class="btn btn-neutral float-left" title="generate_arucoboard" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Rick Staa

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>